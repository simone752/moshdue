name: Datamosh Video Processing

on:
  push:
    branches:
      - main
  workflow_dispatch: # Allows manual trigger

jobs:
  run-datamosh:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          # The environment is already quite bare, so let's use apt-get for full reliability
          sudo apt-get update
          sudo apt-get install ffmpeg -y
          pip install -r requirements.txt

      - name: Run Datamosh Script ðŸš€
        # IMPORTANT: Ensure your script file is named 'script.py' in the root.
        run: python script.py
        # The script creates 'output_horrifying_mosh.mp4' in the root directory.

      - name: Check for Output File Existence
        # This step helps diagnose future issues by confirming the file was created.
        run: ls -l output_horrifying_mosh.mp4
      
      - name: Upload Output Video
        uses: actions/upload-artifact@v4
        with:
          # Use the exact filename and path created by the Python script
          name: horrifying_datamosh_result 
          path: output_horrifying_mosh.mp4
          retention-days: 7 # Optional: keep artifacts for 7 days
